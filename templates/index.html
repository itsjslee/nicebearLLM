
    <!DOCTYPE html>
    <html>
    <head>
        <title>nicebear</title>
        <style>
            :root {
                --bg-color: #ffffff;
                --sidebar-bg: #f0f0f0;
                --border-color: #ccc;
                --text-color: #000000;
                --chat-bg: #f9f9f9;
                --user-msg-color: #0000ff;
                --llm-msg-color: #008000;
                --thinking-color: #808080;
                --hover-color: #e0e0e0;
                --active-color: #d0d0d0;
                --button-bg: #4CAF50;
                --button-color: white;
                --button-hover: #45a049;
                --delete-btn-color: #ff4d4d;
                --delete-btn-hover: #ffcccc;
                --input-bg: #ffffff;
            }
            
            .dark-mode {
                --bg-color: #1e1e1e;
                --sidebar-bg: #2d2d2d;
                --border-color: #444;
                --text-color: #e0e0e0;
                --chat-bg: #2a2a2a;
                --user-msg-color: #7070ff;
                --llm-msg-color: #70c070;
                --thinking-color: #a0a0a0;
                --hover-color: #3a3a3a;
                --active-color: #454545;
                --button-bg: #388e3c;
                --button-color: #e0e0e0;
                --button-hover: #2e7d32;
                --delete-btn-color: #ff6b6b;
                --delete-btn-hover: #ff9e9e;
                --input-bg: #333333;
            }
            
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                display: flex;
                height: 100vh;
                background-color: var(--bg-color);
                color: var(--text-color);
            }
            
            /* Sidebar styles */
            #sidebar {
                width: 250px;
                background-color: var(--sidebar-bg);
                border-right: 1px solid var(--border-color);
                overflow-y: auto;
                display: flex;
                flex-direction: column;
            }
            
            .sidebar-header {
                padding: 15px;
                border-bottom: 1px solid var(--border-color);
                text-align: center;
            }
            
            .conversation-list {
                flex-grow: 1;
                overflow-y: auto;
            }
            
            .conversation-item {
                padding: 10px 15px;
                border-bottom: 1px solid var(--border-color);
                cursor: pointer;
                position: relative;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .conversation-item:hover {
                background-color: var(--hover-color);
            }
            
            .conversation-item.active {
                background-color: var(--active-color);
            }
            
            .delete-btn {
                visibility: hidden;
                color: var(--delete-btn-color);
                cursor: pointer;
                font-weight: bold;
                padding: 2px 6px;
                border-radius: 3px;
            }
            
            .delete-btn:hover {
                background-color: var(--delete-btn-hover);
            }
            
            .conversation-item:hover .delete-btn {
                visibility: visible;
            }
            
            .conversation-title {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex-grow: 1;
            }
            
            .new-chat-btn {
                margin: 10px;
                padding: 8px;
                background-color: var(--button-bg);
                color: var(--button-color);
                border: none;
                border-radius: 4px;
                cursor: pointer;
                text-align: center;
            }
            
            .new-chat-btn:hover {
                background-color: var(--button-hover);
            }
            
            /* Main content styles */
            #main-content {
                flex-grow: 1;
                display: flex;
                flex-direction: column;
                max-width: calc(100% - 250px);
                position: relative;
            }
            
            .header {
                display: flex;
                align-items: center;
                padding: 15px;
                border-bottom: 1px solid var(--border-color);
            }
            
            .bear-image {
                width: 50px;
                height: 50px;
                margin-right: 15px;
            }
            
            #theme-toggle {
                position: absolute;
                top: 15px;
                right: 15px;
                cursor: pointer;
                background-color: var(--button-bg);
                color: var(--button-color);
                border: none;
                border-radius: 4px;
                padding: 5px 10px;
            }
            
            #theme-toggle:hover {
                background-color: var(--button-hover);
            }
            
            #chat-container {
                flex-grow: 1;
                padding: 15px;
                overflow-y: auto;
                background-color: var(--chat-bg);
            }
            
            .user-message {
                color: var(--user-msg-color);
                margin-bottom: 10px;
            }
            
            .llm-message {
                color: var(--llm-msg-color);
                margin-bottom: 20px;
            }
            
            .thinking {
                color: var(--thinking-color);
                font-style: italic;
            }
            
            #input-container {
                display: flex;
                padding: 10px;
                border-top: 1px solid var(--border-color);
            }
            
            #user-input {
                flex-grow: 1;
                padding: 10px;
                margin-right: 10px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                background-color: var(--input-bg);
                color: var(--text-color);
            }
            
            button {
                padding: 10px 15px;
                background-color: var(--button-bg);
                color: var(--button-color);
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            
            button:hover {
                background-color: var(--button-hover);
            }
        </style>
    </head>
    <body>
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="sidebar-header">
                <h3>Conversations</h3>
            </div>
            <div class="new-chat-btn" onclick="startNewChat()">New Chat</div>
            <div id="conversation-list" class="conversation-list">
                <!-- Conversation history will be populated here -->
            </div>
        </div>
        
        <!-- Main Content -->
        <div id="main-content">
            <div class="header">
                <img src="/lightbear.png" alt="Bear" class="bear-image" id="bear-image">
                <h1>nicebear</h1>
                <button id="theme-toggle">ðŸŒ™ Dark Mode</button>
            </div>
            <div id="chat-container">
                <div>chat with bear</div>
                <div>type your message</div>
                <br>
            </div>
            <div id="input-container">
                <input type="text" id="user-input" placeholder="Type your message here...">
                <button id="send-button">Send</button>
            </div>
        </div>

        <script>
            const chatContainer = document.getElementById('chat-container');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const conversationList = document.getElementById('conversation-list');
            const themeToggle = document.getElementById('theme-toggle');
            const bearImage = document.getElementById('bear-image');
            const body = document.body;
            
            // Store conversations
            let conversations = [];
            let currentConversationId = null;
            
            // Theme management
            function toggleTheme() {
                if (body.classList.contains('dark-mode')) {
                    // Switch to light mode
                    body.classList.remove('dark-mode');
                    themeToggle.textContent = 'ðŸŒ™ Dark Mode';
                    bearImage.src = '/lightbear.png';
                    localStorage.setItem('nicebear-theme', 'light');
                } else {
                    // Switch to dark mode
                    body.classList.add('dark-mode');
                    themeToggle.textContent = 'â˜€ï¸ Light Mode';
                    bearImage.src = '/darkbear.png';
                    localStorage.setItem('nicebear-theme', 'dark');
                }
            }
            
            // Initialize theme based on saved preference
            function initTheme() {
                const savedTheme = localStorage.getItem('nicebear-theme');
                if (savedTheme === 'dark') {
                    body.classList.add('dark-mode');
                    themeToggle.textContent = 'â˜€ï¸ Light Mode';
                    bearImage.src = '/darkbear.png';
                }
            }
            
            themeToggle.addEventListener('click', toggleTheme);
            
            // Load conversations from localStorage if available
            function loadConversations() {
                const savedConversations = localStorage.getItem('nicebear-conversations');
                if (savedConversations) {
                    conversations = JSON.parse(savedConversations);
                    renderConversationList();
                }
                
                // Start a new chat if no conversations exist
                if (conversations.length === 0) {
                    startNewChat();
                } else {
                    // Load the most recent conversation
                    loadConversation(conversations[0].id);
                }
            }
            
            // Save conversations to localStorage
            function saveConversations() {
                localStorage.setItem('nicebear-conversations', JSON.stringify(conversations));
            }
            
            // Delete a conversation
            function deleteConversation(id, event) {
                // Prevent the click from propagating to the parent (which would load the conversation)
                event.stopPropagation();
                
                // Ask for confirmation
                if (confirm('Are you sure you want to delete this conversation?')) {
                    // Remove the conversation from the array
                    const index = conversations.findIndex(c => c.id === id);
                    if (index !== -1) {
                        conversations.splice(index, 1);
                    }
                    
                    // If we deleted the current conversation, load another one
                    if (id === currentConversationId) {
                        if (conversations.length > 0) {
                            loadConversation(conversations[0].id);
                        } else {
                            startNewChat();
                        }
                    }
                    
                    // Update UI and save
                    renderConversationList();
                    saveConversations();
                }
            }
            
            // Render the conversation list in the sidebar
            function renderConversationList() {
                conversationList.innerHTML = '';
                
                conversations.forEach(conv => {
                    const item = document.createElement('div');
                    item.className = 'conversation-item';
                    if (conv.id === currentConversationId) {
                        item.classList.add('active');
                    }
                    
                    // Use the first user message as the title, or a default title
                    let title = 'New conversation';
                    for (const message of conv.messages) {
                        if (message.role === 'user') {
                            title = message.content.substring(0, 25);
                            if (message.content.length > 25) title += '...';
                            break;
                        }
                    }
                    
                    // Create title span
                    const titleSpan = document.createElement('span');
                    titleSpan.className = 'conversation-title';
                    titleSpan.textContent = title;
                    item.appendChild(titleSpan);
                    
                    // Create delete button
                    const deleteBtn = document.createElement('span');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'x';
                    deleteBtn.title = 'Delete conversation';
                    deleteBtn.onclick = (e) => deleteConversation(conv.id, e);
                    item.appendChild(deleteBtn);
                    
                    // Set click handler for the item
                    item.onclick = () => loadConversation(conv.id);
                    
                    conversationList.appendChild(item);
                });
            }
            
            // Start a new chat
            function startNewChat() {
                const newId = Date.now().toString();
                const newConversation = {
                    id: newId,
                    messages: []
                };
                
                // Add to the beginning of the array (most recent first)
                conversations.unshift(newConversation);
                currentConversationId = newId;
                
                // Clear the chat container
                chatContainer.innerHTML = '<div>chat with bear</div><div>type your message</div><br>';
                
                // Update UI
                renderConversationList();
                saveConversations();
            }
            
            // Load a conversation
            function loadConversation(id) {
                const conversation = conversations.find(c => c.id === id);
                if (!conversation) return;
                
                currentConversationId = id;
                
                // Clear the chat container
                chatContainer.innerHTML = '';
                
                // Render all messages
                conversation.messages.forEach(msg => {
                    if (msg.role === 'user') {
                        addMessage(`You: ${msg.content}`, 'user-message');
                    } else if (msg.role === 'assistant') {
                        addMessage(`LLM: ${msg.content}`, 'llm-message');
                    }
                });
                
                // Update UI
                renderConversationList();
            }
            
            function addMessage(text, className) {
                const messageDiv = document.createElement('div');
                messageDiv.className = className;
                messageDiv.textContent = text;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return messageDiv;
            }
            
            function getCurrentConversation() {
                return conversations.find(c => c.id === currentConversationId);
            }
            
            async function sendMessage() {
                const message = userInput.value.trim();
                if (!message) return;
                
                // Get current conversation
                const conversation = getCurrentConversation();
                if (!conversation) return;
                
                // Add user message
                addMessage(`You: ${message}`, 'user-message');
                userInput.value = '';
                
                // Store the message
                conversation.messages.push({
                    role: 'user',
                    content: message
                });
                
                // Add thinking message
                const thinkingDiv = addMessage('nicebear says...', 'thinking');
                
                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message }),
                    });
                    
                    const data = await response.json();
                    
                    // Remove thinking message
                    chatContainer.removeChild(thinkingDiv);
                    
                    // Add LLM response
                    addMessage(`LLM: ${data.response}`, 'llm-message');
                    
                    // Store the response
                    conversation.messages.push({
                        role: 'assistant',
                        content: data.response
                    });
                    
                    // Update the conversation list (in case this is the first message)
                    renderConversationList();
                    
                    // Save to localStorage
                    saveConversations();
                } catch (error) {
                    // Remove thinking message
                    chatContainer.removeChild(thinkingDiv);
                    
                    // Add error message
                    addMessage(`Error: ${error.message}`, 'llm-message');
                }
            }
            
            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Initialize
            initTheme();
            loadConversations();
        </script>
    </body>
    </html>
    